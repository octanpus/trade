[{"/home/kali/Downloads/market/market/src/index.js":"1","/home/kali/Downloads/market/market/src/App.js":"2","/home/kali/Downloads/market/market/src/reportWebVitals.js":"3","/home/kali/Downloads/market/market/src/market.js":"4"},{"size":547,"mtime":1696717949000,"results":"5","hashOfConfig":"6"},{"size":193,"mtime":1696758916978,"results":"7","hashOfConfig":"6"},{"size":362,"mtime":1696717967000,"results":"8","hashOfConfig":"6"},{"size":51945,"mtime":1696762291000,"results":"9","hashOfConfig":"6"},{"filePath":"10","messages":"11","suppressedMessages":"12","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"105mxkj",{"filePath":"13","messages":"14","suppressedMessages":"15","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"16","messages":"17","suppressedMessages":"18","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"19","messages":"20","suppressedMessages":"21","errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"22"},"/home/kali/Downloads/market/market/src/index.js",[],[],"/home/kali/Downloads/market/market/src/App.js",[],[],"/home/kali/Downloads/market/market/src/reportWebVitals.js",[],[],"/home/kali/Downloads/market/market/src/market.js",["23","24","25","26","27","28","29","30","31","32"],[],"import React, { useState, useEffect } from 'react';\nimport Dropzone from 'react-dropzone'\nimport InputAutoSuggest from 'react-input-autosuggest'\n//import 'react-input-autosuggest/dist/index.css'\nimport { NavbarBrand, Navbar, Progress, Container, Col, Row, Nav, NavItem, NavLink, TabContent, TabPane, Button, Input,FormText } from 'reactstrap';\nimport { InputGroup, InputGroupAddon, InputGroupText, Table } from 'reactstrap';\nimport {\n  Card, CardImg, CardText, CardBody,\n  CardTitle, CardSubtitle,\n} from 'reactstrap';\nimport classnames from 'classnames';\nimport Select from 'react-select';\n//import makeAnimated from 'react-select/animated';\nimport latest_thumbnail from './latest_thumbnail.png'\n\n/*\nvar commodities = {9850:[\"Spirits\",0.2],\n                   43:[\"Antibiotics\",0.5],\n                   3717:[\"Dairy Products\",0.5],\n                   3715:[\"Frozen Food\",0.5],\n                   45:[\"Frozen Plant Seeds\",0.5],\n                   3647:[\"Holoreels\",0.5],\n                   12478:[\"Khumaak\",0.3],\n                   3777:[\"Long-limb Roes\",1],\n                   11855:[\"Protein Delicacies\",0.5],\n                   3699:[\"Quafe\",0.1],\n                   42:[\"Spiced Wine\",0.5],\n                   9852:[\"Tobacco\",0.2],\n                   3673:[\"Wheat\",1.15],\n                   3812:[\"Data Sheets\",1],\n                   3687:[\"Electronic Parts\",1],\n                   41:[\"Garbage\",0.25],\n                   3773:[\"Hydrochloric Acid\",0.5],\n                   3685:[\"Hydrogen Batteries\",1],\n                   3643:[\"Soil\",1.5],\n                   3713:[\"Vitoc\",0.5],\n                   3723:[\"Slaver Hound\",1],\n                   3729:[\"Toxic Waste\",1],\n                   3721:[\"Slaves\",5]\n                 };*/\n\nvar hubs = {Jita: {region: 10000002, location: 60003760, name: \"Jita\"},\n            Amarr: {region: 10000043, location: 60008494, name: \"Amarr\"},\n            Dodixie: {region: 10000032, location: 60011866, name: \"Dodixie\"},\n            Hek: {region: 10000042, location: 60005686, name: \"Hek\"},\n            Oursulaert: {region: 10000064, location: 60011740, name: \"Oursulaert\"},\n            Alentene: {region: 10000068, location: 60010300, name: \"Alentene\"},\n            Stacmon: { region: 10000048, location: 60011893, name: \"Stacmon\" },\n\t\t\tVillore: { region: 10000064, location: 60009928, name: \"Villore\" },\n\t\t\tFrarn: { region: 10000030, location: 1031084757448, name: \"Frarn\" },\n\t\t\tOrvolle: { region: 10000048, location: 1033196707294, name: \"Orvolle\" },\n\t\t\tAmamake: { region: 10000030, location: 1022167642188, name: \"Amamake\" },\n\t\t\tLitiura: { region: 10000016, location: 60006844, name: \"Litiura\" },\n\t\t\tVlillirier: { region: 10000048, location: 60001393, name: \"Vlillirier\" }};\n\nvar hubs_by_id = {60003760: hubs.Jita,\n                  60008494: hubs.Amarr,\n                  60004588: hubs.Rens,\n                  60011866: hubs.Dodixie,\n                  60005686: hubs.Hek,\n                  60011740: hubs.Oursulaert,\n                  60010300: hubs.Alentene,\n                  60011893: hubs.Stacmon,\n\t\t\t\t  60009928: hubs.Villore,\n\t\t\t\t  1031084757448: hubs.Frarn,\n\t\t\t\t  1033196707294: hubs.Orvolle,\n\t\t\t\t  1022167642188: hubs.Amamake,\n\t\t\t\t  60006844: hubs.Litiura,\n\t\t\t\t  60001393: hubs.Vlillirier}\n/*\nvar tradeble_ids = [34, 35, 36, 38, 638, 4051, 4246, 4247, 4347, 4349, 9848, 11399, 11993, 12005, 15632, 15681, 15806, 15963,\n 16274, 16636, 16641, 16643, 16644, 16648, 16650, 16651, 16652, 16653, 16678, 16683, 17559, 17715, 17736,\n 17738, 17740, 17887, 17888, 17889, 17918, 18789, 19045, 19191, 19198, 19200, 19207, 19208, 19359, 19417,\n 19421, 20160, 20161, 20185, 25594, 25617, 25619, 25624, 25625, 28444, 28606, 28659, 28661, 28665, 28668,\n 28710, 29984, 29986, 29990, 30251, 30744, 30745, 30746, 30747, 31796, 31930, 31932, 33468, 33470, 33472,\n 33681, 33820, 33844, 34133, 35835, 40519, 40520, 41218, 44992, 45635, 47270, 47271, 47466, 48112, 48121,\n 48582, 49711, 52252, 52568, 55826, 56202, 57457];*/\n/*\nvar empire_regions = [10000054, 10000036, 10000043,\n                     10000067, 10000052, 10000065, 10000020, 10000038,\n                     10000016, 10000033, 10000002,\n                     10000064, 10000037, 10000048, 10000032, 10000044, 10000068,\n                     10000042, 10000030, 10000028,\n                     10000049, 10000001];*/\n\nvar esi_host = 'https://esi-cache.pterippi.fi/';\n/*\nvar mineraldata = JSON.parse(\"[{\\\"ore\\\":1230,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":415},{\\\"mineral\\\":35,\\\"quantity\\\":0},{\\\"mineral\\\":36,\\\"quantity\\\":0},{\\\"mineral\\\":37,\\\"quantity\\\":0},{\\\"mineral\\\":38,\\\"quantity\\\":0},{\\\"mineral\\\":39,\\\"quantity\\\":0},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":1228,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":346},{\\\"mineral\\\":35,\\\"quantity\\\":173},{\\\"mineral\\\":36,\\\"quantity\\\":0},{\\\"mineral\\\":37,\\\"quantity\\\":0},{\\\"mineral\\\":38,\\\"quantity\\\":0},{\\\"mineral\\\":39,\\\"quantity\\\":0},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":1224,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":351},{\\\"mineral\\\":35,\\\"quantity\\\":25},{\\\"mineral\\\":36,\\\"quantity\\\":50},{\\\"mineral\\\":37,\\\"quantity\\\":0},{\\\"mineral\\\":38,\\\"quantity\\\":5},{\\\"mineral\\\":39,\\\"quantity\\\":0},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":18,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":107},{\\\"mineral\\\":35,\\\"quantity\\\":213},{\\\"mineral\\\":36,\\\"quantity\\\":107},{\\\"mineral\\\":37,\\\"quantity\\\":0},{\\\"mineral\\\":38,\\\"quantity\\\":0},{\\\"mineral\\\":39,\\\"quantity\\\":0},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":1227,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":800},{\\\"mineral\\\":35,\\\"quantity\\\":100},{\\\"mineral\\\":36,\\\"quantity\\\":0},{\\\"mineral\\\":37,\\\"quantity\\\":85},{\\\"mineral\\\":38,\\\"quantity\\\":0},{\\\"mineral\\\":39,\\\"quantity\\\":0},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":20,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":134},{\\\"mineral\\\":35,\\\"quantity\\\":0},{\\\"mineral\\\":36,\\\"quantity\\\":267},{\\\"mineral\\\":37,\\\"quantity\\\":134},{\\\"mineral\\\":38,\\\"quantity\\\":0},{\\\"mineral\\\":39,\\\"quantity\\\":0},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":1226,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":0},{\\\"mineral\\\":35,\\\"quantity\\\":0},{\\\"mineral\\\":36,\\\"quantity\\\":350},{\\\"mineral\\\":37,\\\"quantity\\\":0},{\\\"mineral\\\":38,\\\"quantity\\\":75},{\\\"mineral\\\":39,\\\"quantity\\\":8},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":1231,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":2200},{\\\"mineral\\\":35,\\\"quantity\\\":0},{\\\"mineral\\\":36,\\\"quantity\\\":0},{\\\"mineral\\\":37,\\\"quantity\\\":100},{\\\"mineral\\\":38,\\\"quantity\\\":120},{\\\"mineral\\\":39,\\\"quantity\\\":15},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":21,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":0},{\\\"mineral\\\":35,\\\"quantity\\\":1000},{\\\"mineral\\\":36,\\\"quantity\\\":0},{\\\"mineral\\\":37,\\\"quantity\\\":200},{\\\"mineral\\\":38,\\\"quantity\\\":100},{\\\"mineral\\\":39,\\\"quantity\\\":19},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":1229,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":0},{\\\"mineral\\\":35,\\\"quantity\\\":2200},{\\\"mineral\\\":36,\\\"quantity\\\":2400},{\\\"mineral\\\":37,\\\"quantity\\\":300},{\\\"mineral\\\":38,\\\"quantity\\\":0},{\\\"mineral\\\":39,\\\"quantity\\\":0},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":1232,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":10000},{\\\"mineral\\\":35,\\\"quantity\\\":0},{\\\"mineral\\\":36,\\\"quantity\\\":0},{\\\"mineral\\\":37,\\\"quantity\\\":1600},{\\\"mineral\\\":38,\\\"quantity\\\":120},{\\\"mineral\\\":39,\\\"quantity\\\":0},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":1225,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":21000},{\\\"mineral\\\":35,\\\"quantity\\\":0},{\\\"mineral\\\":36,\\\"quantity\\\":0},{\\\"mineral\\\":37,\\\"quantity\\\":0},{\\\"mineral\\\":38,\\\"quantity\\\":760},{\\\"mineral\\\":39,\\\"quantity\\\":135},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":19,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":56000},{\\\"mineral\\\":35,\\\"quantity\\\":12050},{\\\"mineral\\\":36,\\\"quantity\\\":2100},{\\\"mineral\\\":37,\\\"quantity\\\":450},{\\\"mineral\\\":38,\\\"quantity\\\":0},{\\\"mineral\\\":39,\\\"quantity\\\":0},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":1223,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":0},{\\\"mineral\\\":35,\\\"quantity\\\":12000},{\\\"mineral\\\":36,\\\"quantity\\\":0},{\\\"mineral\\\":37,\\\"quantity\\\":0},{\\\"mineral\\\":38,\\\"quantity\\\":0},{\\\"mineral\\\":39,\\\"quantity\\\":450},{\\\"mineral\\\":40,\\\"quantity\\\":100},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":22,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":22000},{\\\"mineral\\\":35,\\\"quantity\\\":0},{\\\"mineral\\\":36,\\\"quantity\\\":2500},{\\\"mineral\\\":37,\\\"quantity\\\":0},{\\\"mineral\\\":38,\\\"quantity\\\":0},{\\\"mineral\\\":39,\\\"quantity\\\":0},{\\\"mineral\\\":40,\\\"quantity\\\":320},{\\\"mineral\\\":11399,\\\"quantity\\\":0}]},{\\\"ore\\\":11396,\\\"composition\\\":[{\\\"mineral\\\":34,\\\"quantity\\\":0},{\\\"mineral\\\":35,\\\"quantity\\\":0},{\\\"mineral\\\":36,\\\"quantity\\\":0},{\\\"mineral\\\":37,\\\"quantity\\\":0},{\\\"mineral\\\":38,\\\"quantity\\\":0},{\\\"mineral\\\":39,\\\"quantity\\\":0},{\\\"mineral\\\":40,\\\"quantity\\\":0},{\\\"mineral\\\":11399,\\\"quantity\\\":300}]}]\");\nvar ore_flavors = {22: {plus_5: 17425, plus_10: 17426},\n                   1223: {plus_5: 17428, plus_10: 17429},\n                   1224: {plus_5: 17459, plus_10: 17460},\n                   18: {plus_5: 17455, plus_10: 17456},\n                   19: {plus_5: 17466, plus_10: 17467},\n                   1230: {plus_5: 17470, plus_10: 17471},\n                   1228: {plus_5: 17463, plus_10: 17464},\n                   1225: {plus_5: 17432, plus_10: 17433},\n                   1232: {plus_5: 17436, plus_10: 17437},\n                   20: {plus_5: 17452, plus_10: 17453},\n                   1229: {plus_5: 17865, plus_10: 17866},\n                   1227: {plus_5: 17867, plus_10: 17868},\n                   21: {plus_5: 17440, plus_10: 17441},\n                   1231: {plus_5: 17444, plus_10: 17445},\n                   1226: {plus_5: 17448, plus_10: 17449},\n                   11396: {plus_5: 17869, plus_10: 17870}};*/\n//var compressed_ores = []\n\nfunction makeAjax(url, cb)\n{\n  return fetch(url)\n          .then(response => cb(response.json(), response.statusText, response.headers));\n}\n/*\nfunction ajaxPost(url, json_data, cb)\n{\n  const requestOptions = {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: json_data\n  };\n  fetch(url, requestOptions)\n        .then(response => response.json())\n        .then(x => cb(x))\n}*/\n\nfunction range(start, end)\n{\n    return Array.from(Array(end + 1).keys()).filter(x => (x >= start));\n}\n\n\nvar request_cache = {};\nasync function loadMultipageQuery(url)\n{\n    //'https://esi.tech.ccp.is/latest/markets/10000067/orders/?datasource=tranquility&type_id=3687&page=1'\n    var timeout = 5000;\n    var i_to = 3;\n    if (request_cache[url])\n    {\n      if ((new Date() - request_cache[url].timestamp) < 300000)\n      {\n          return request_cache[url].d;\n      }\n    }\n    while (true)\n    {\n      try\n      {\n        let result = await makeAjax(url+'&page=1', (data, textStatus, header) => {\n                var pagecnt = header['x-pages'];\n                //console.log(pagecnt);\n                if (pagecnt > 1)\n                {\n                    let result = Promise.all(range(2,pagecnt).map(\n                      pagenum => makeAjax(url+'&page='+pagenum, (x)=>x))\n                    ).then(datas => datas.reduce((x,y) => x.concat(y), data))\n                    return result;\n                }\n                else\n                {\n                  return data;\n                }\n\n            })\n        if (!result.filter)\n        {\n        console.log(result)\n        }\n        request_cache[url] = {timestamp: new Date(), d: result};\n        return result;\n      }\n      catch (e)\n      {\n        console.error(e)\n        await new Promise(r => setTimeout(r, timeout));\n        timeout *= i_to;\n        i_to += 1;\n      }\n    }\n}\n\nfunction queryPrice(typeid, region, location, batchPriceLimit)\n{\n\n    return loadMultipageQuery(esi_host+'latest/markets/'+region+'/orders/?datasource=tranquility&type_id='+typeid)\n        .then(data => data.filter(x => (!x.is_buy_order && x.location_id === location))\n                          .sort((x, y) => (x.price - y.price))\n                          .reduce((x, y) => ((x.total_cost < batchPriceLimit)?\n                              {total_cost: batchPriceLimit < (x.total_cost + y.price*y.volume_remain)?batchPriceLimit:(x.total_cost + y.price*y.volume_remain),\n                               total_cnt: batchPriceLimit < (x.total_cost + y.price*y.volume_remain)?(x.total_cnt + (batchPriceLimit - x.total_cost)/y.price):(x.total_cnt + y.volume_remain),\n                               on_sale_volume: (x.on_sale_volume + y.volume_remain)}\n                              :x), {total_cost: 0, total_cnt: 0, on_sale_volume: 0}))\n        .then(x => ({id: typeid,\n                     price: x.total_cnt > 0 ? (x.total_cost/x.total_cnt) : 0,\n                     on_sale_volume: x.on_sale_volume}))\n}\n\nfunction queryLowestPrice(typeid, region, location)\n{\n\n    try\n    {\n    return loadMultipageQuery(esi_host+'latest/markets/'+region+'/orders/?datasource=tranquility&type_id='+typeid)\n        .then(data => data.filter(x => (!x.is_buy_order && x.location_id === location))\n                          .map(x => x.price)\n                          .reduce((x,y) => Math.min(x, y), Infinity))\n        .then(x => ({id: typeid,\n                         price: x}))\n    }\n    catch (e)\n    {\n      return [];\n    }\n}\n\nfunction queryCheapestOrder(typeid, region, location)\n{\n    try\n    {\n    return loadMultipageQuery(esi_host+'latest/markets/'+region+'/orders/?datasource=tranquility&type_id='+typeid)\n        .then(data => data.filter(x => (!x.is_buy_order && x.location_id === location))\n                          .sort((x, y) => (x.price - y.price))[0])\n    }\n    catch (e)\n    {\n      return [];\n    }\n}\n\nfunction queryVolumeBelowPrice(typeid, treshold_price, region, location)\n{\n    try\n    {\n    return loadMultipageQuery(esi_host+'latest/markets/'+region+'/orders/?datasource=tranquility&type_id='+typeid)\n        .then(data => data.filter(x => (!x.is_buy_order && x.location_id === location))\n                          .filter(x => (x.price < treshold_price))\n                          .reduce((x, y) => x + y.volume_remain, 0))\n    }\n    catch (e)\n    {\n      return [];\n    }\n}\n\nfunction queryPriceHistoryAndVolume(typeid, region, period)\n{\n\n      try\n      {\n    return loadMultipageQuery(esi_host+'latest/markets/'+region+'/history/?datasource=tranquility&type_id='+typeid)\n        .then(data => data.slice(-period)\n                          .reduce((x, y) => ({total_cost: x.total_cost + y.average*y.volume,\n                                              total_cnt: x.total_cnt + y.volume}),\n                                            {total_cost: 0, total_cnt: 0}))\n        .then(x => ({id: typeid,\n                     avg_price: x.total_cnt > 0 ? (x.total_cost/x.total_cnt) : 0,\n                     daily_volume: x.total_cnt/period}))\n      }\n      catch (e)\n      {\n        return [];\n      }\n}\n\nasync function calculateProfitability(types, start, dest, maxUnitPrice, maxUnitVolume, ignoredTypeIds, setReport, setQueryInProgress)\n{\n    let start_hub = hubs[start];\n    let dest_hub = hubs[dest];\n    let result = [];\n    let types_and_prices = await Promise.all(types.map(async (x) => ({id: x.id,\n                                         buy: await queryPrice(x.id, start_hub.region, start_hub.location, 100000000),\n                                         sell: await queryPrice(x.id, dest_hub.region, dest_hub.location, 100000000),\n                                         history: await queryPriceHistoryAndVolume(x.id, dest_hub.region, 14),\n                                         info: x})));\n    console.log(types_and_prices)\n    let ignoredInLocation = ignoredTypeIds.filter(x => x[1] === dest_hub.location)\n                                          .map(x => x[0]);\n    result = types_and_prices.filter(x => !ignoredInLocation.includes(x.id) )\n                             .map(x => ({id: x.id,\n                                   price_delta: (x.sell.price > 0 ? x.sell.price : x.history.avg_price * 1.5) - x.buy.price,\n                                   price_margin: 100*((x.sell.price > 0 ? x.sell.price : x.history.avg_price * 1.5) - x.buy.price)/(x.sell.price > 0 ? x.sell.price : x.history.avg_price * 1.5),\n                                   history: x.history,\n                                   sell: x.sell,\n                                   buy: x.buy,\n                                   info: x.info}))\n                             .filter(x => x.buy.on_sale_volume > 0)\n                             .filter(x => x.buy.price < maxUnitPrice*1000000)\n                             .filter(x => x.info.volume < maxUnitVolume)\n                             .filter(x => x.sell.on_sale_volume/x.history.daily_volume < 1)\n                             .filter(x => x.price_margin > 0)\n                             .sort((x, y) => (y.price_margin - x.price_margin))\n\n\n    setReport(result);\n    setQueryInProgress(false);\n}\n\n\nasync function getSuggestedSellPrice(types, selectedTypes, dest, setReport, setQueryInProgress)\n{\n    let dest_hub = hubs[dest];\n    let types_and_prices = await Promise.all(types.filter(x => selectedTypes.includes(x.id) )\n                                                  .map(async (x) => ({id: x.id,\n                                         sell: await queryLowestPrice(x.id, dest_hub.region, dest_hub.location, 100000000),\n                                         history: await queryPriceHistoryAndVolume(x.id, dest_hub.region, 14),\n                                         info: x})));\n    console.log(types_and_prices)\n    let result_unsorted = types_and_prices.map(x => ({id: x.id,\n                                   history: x.history,\n                                   sell: {price: Number(((x.sell.price < Infinity) ? (x.sell.price*0.995):(x.history.avg_price * 1.99)).toPrecision(4))},\n                                   info: x.info}))\n    let result = selectedTypes.map(tid => result_unsorted.filter(t => t.id === tid)[0])\n\n    setReport(result);\n    setQueryInProgress(false);\n}\n\n\n//var orders_cache = {}\n/*\nasync function queryNPCOrdersInEmpires(typeid)\n{\n    if (orders_cache[typeid])\n    {\n        if (Date.now() - orders_cache[typeid].time < 300000)\n        {\n          return orders_cache[typeid].data;\n        }\n    }\n\n    var orders_by_regions = Promise.all(empire_regions.map((region) => loadMultipageQuery(esi_host+'latest/markets/'+region+'/orders/?datasource=tranquility&type_id='+typeid)))\n    var orders = [].concat.apply([], await orders_by_regions);\n    //console.log(orders)\n    var max_sell_volume = 0;\n    var max_buy_volume = 0;\n    var max_buy_price = 0;\n    var min_sell_price = 100000000000000000;\n\n    var sell_orders = orders.filter(x => (!x.is_buy_order && x.duration === 365));\n    var buy_orders = orders.filter(x => (x.is_buy_order && x.duration === 365));\n    sell_orders.map((x) => {\n      if (x.volume_remain > max_sell_volume)\n      {\n        max_sell_volume = x.volume_remain;\n      }\n      if (x.price < min_sell_price)\n      {\n        min_sell_price = x.price ;\n      }\n    })\n    buy_orders.map((x) => {\n      if (x.volume_remain > max_buy_volume)\n      {\n        max_buy_volume = x.volume_remain;\n      }\n      if (x.price > max_buy_price)\n      {\n        max_buy_price = x.price ;\n      }\n    })\n\n    sell_orders = sell_orders.filter(x => (x.price < max_buy_price));\n    buy_orders = buy_orders.filter(x => (x.price > min_sell_price));\n    sell_orders = sell_orders.filter(x => (x.volume_remain > 0.2*max_sell_volume));\n    buy_orders = buy_orders.filter(x => (x.volume_remain > 0.2*max_buy_volume));\n\n\n    orders_cache[typeid] = {time:Date.now(), data: [sell_orders, buy_orders]}\n    return [sell_orders, buy_orders];\n}\n*//*\nasync function queryOrdersByLocation(typeid, region, threshold)\n{\n    var orders = await loadMultipageQuery(esi_host+'latest/markets/'+region+'/orders/?datasource=tranquility&type_id='+typeid)\n        .then(data => data.filter(x => (!x.is_buy_order && x.price < threshold))\n                          .sort((x, y) => (x.price - y.price)));\n\n    var stations = orders.reduce((x, y) => x.add(y.location_id), new Set());\n\n    var station_volume = []\n    stations.forEach((v1,v2,s) => {station_volume.push([v1, orders.filter(x => x.location_id === v1)\n                                                             .reduce((x, y) => ({oreid: typeid, total_cost: x.total_cost + y.price*y.volume_remain, total_cnt: x.tota_cnt + y.volume_remain}), {total_cost: 0, tota_cnt: 0})\n                                                             ])});\n    return station_volume;\n}**/\n\n/*\nasync function getStationJumps(id)\n{\n    var info = await makeAjax(esi_host+'latest/universe/stations/'+id+'/?datasource=tranquility', stinfo => [stinfo.name, stinfo.system_id]);\n\n    var route = await makeAjax(esi_host+'latest/route/30002188/'+info[1]+'/?datasource=tranquility&flag=shortest', (x) => x);\n    return [info[0], route];\n}*/\n/*\nasync function finalizeReport(ndata, stations_orders, stations_total, types, setReportData)\n{\n    var names = ndata.reduce((x, y) => {x[y.id]= y.name; return x; }, {});\n    stations_total.sort((x,y)=>y[1]-x[1])\n\n\n    var jumps = await Promise.all(stations_total.map(st => getStationJumps(st[0])));\n    console.log(jumps)\n        //\n    var data = stations_total.map(st => [names[st[0]], jumps.filter(x=>x[0]===names[st[0]]).map(x=> x[1])[0], st[1], stations_orders.filter(x => x[0] === st[0]).map(x => [types[x[1].oreid], x[1].total_cost, x[1].total_cost/x[1].total_cnt])])\n    console.log(data)\n    setReportData(data)\n    //$('#ore_report').html('<table>'+data.map(x => '<tr><td>'+[x[0],x[2],x[3].join('<br>')].join('</td><td>')+'</td></tr>').join('')+'</table>')\n}*/\n/*\nasync function processNamesAndRun(data, region, setReportData)\n{\n    var names = data.reduce((x, y) => {x[y.id]= y.name; return x; }, {});\n    var mineral_prices = await Promise.all(minerals.map(x => queryPrice(x, 10000002, 60003760)))\n        .then(x=> x.map((z) => {z.name = names[z.id]; return z;})\n                               .reduce((a, x)=> {a[x.id] = x; return a;}, []))\n    //[x.ore, ore_flavors[x.ore].plus_5, ore_flavors[x.ore].plus_10]\n    var r=[]\n    mineraldata.map(x => {r.push([x.ore, names[x.ore], x.composition.reduce((tot, mine) => tot + mine.quantity * mineral_prices[mine.mineral].price/100, 0)*refinerate]);\n                          r.push([ore_flavors[x.ore].plus_5, names[ore_flavors[x.ore].plus_5], 1.05*x.composition.reduce((tot, mine) => tot + mine.quantity * mineral_prices[mine.mineral].price/100, 0)*refinerate]);\n                          r.push([ore_flavors[x.ore].plus_10, names[ore_flavors[x.ore].plus_10], 1.10*x.composition.reduce((tot, mine) => tot + mine.quantity * mineral_prices[mine.mineral].price/100, 0)*refinerate]);\n                          });\n\n    var allstations = await Promise.all(r.map(x=> queryOrdersByLocation(x[0], region, x[2]))).then(x=>x.reduce((x,y) => x.concat(y)));\n    var stations = Array.from(allstations.reduce((x, y) => x.add(y[0]), new Set()));\n    var totals = stations.map(stid => [stid, allstations.filter(x => x[0] == stid).reduce((x,y) => x + y[1].total_cost, 0)])\n    ajaxPost(esi_host+'latest/universe/names/?datasource=tranquility',\n              JSON.stringify(stations),\n              x=>finalizeReport(x, allstations, totals, names, setReportData))\n}*/\n//\n//var refinerate = 0.7;\n//var minerals=[34,35,36,37,38,39,40,11399];\n\n//var allIds = mineraldata.map(x => [x.ore, ore_flavors[x.ore].plus_5, ore_flavors[x.ore].plus_10]).reduce((x,y)=>x.concat(y),minerals)\n\n\nfunction Market() {\n    /*var [reportData, setReportData] = useState([]);\n    const [systemRange,setSystemRange]=useState([]);\n    const [systemRangeLS,setSystemRangeLS]=useState([]);\n    const [selectedRangeDB,setSelectedRangeDB]=useState(\"HS\");\n    const [systemName,setSystemName]=useState('');\n    const [systemNameToId,setSystemNameToId]=useState([]);\n    const [systemIdToName,setSystemIdToName]=useState([]);\n    const [systemAutocomplete,setSystemAutocomplete]=useState([]);\n    const [startSystemId,setStartSystemId]=useState(0);\n    const [calculationResult,setCalculationResult]=useState([-1, [0, 0, 0]]);\n    const [selectedWareId,setSelectedWareId]=useState(0);\n    const [calculationProgress,setCalculationProgress]=useState(-1);\n    const [taxRate,setTaxRate]=useState(5);*/\n    const [activeTab,setActiveTab]=useState('1');\n    /*const [multiWares, setMultiWares]=useState([]);\n    const [processedWare, setProcessedWare]=useState(-1);\n    const [multiResult, setMultiResult]=useState([]);*/\n\n    // New states\n    const [selectedStart,setSelectedStart]=useState(\"Jita\");\n    const [selectedEnd,setSelectedEnd]=useState(\"Amarr\");\n    //const [maxCargo,setMaxCargo]=useState(20000);\n    const [maxValue,setMaxValue]=useState(60);\n    const [maxUnitPrice,setMaxUnitPrice]=useState(30);\n    const [maxUnitVolume,setMaxUnitVolume]=useState(500);\n    const [profitReport,setProfitReport]=useState([]);\n    const [tradableTypes, setTradableTypes]=useState([]);\n    const [allTypes, setAllTypes]=useState([]);\n    const [selectedTypes, setSelectedTypes]=useState([]);\n    const [buyOrderLines, setBuyOrderLines]=useState([]);\n    const [estimatedBuyVolume, setEstimatedBuyVolume]=useState(0);\n    const [queryInProgress, setQueryInProgress]=useState(false);\n    const [ignoreExistingOrders, setIgnoreExistingOrders]=useState(false);\n    const [ignoredTypeIds, setIgnoredTypeIds]=useState([]);\n    const [inventoryRaw, setInventoryRaw]=useState(\"\");\n    const [suggestedSell, setSuggestedSell]=useState([]);\n    //const [undercutIsCorp, setUndercutIsCorp]=useState(false);\n    const [underCutReport, setUnderCutReport]=useState([]);\n    const [valueSplit, setValueSplit]=useState({label: \"Equal\", value: \"equal\"});\n\n    let devMode = window.location.hostname.includes(\"localhost\");\n\n    if (devMode)\n    {\n      esi_host = 'https://esi.evetech.net/';\n    }\n\n    let maxPrice = maxValue*1000000;\n\n    useEffect(()=>{\n      /*fetch('ls_hs_system_to_system_range.json'\n          ,{headers : {'Content-Type': 'application/json',\n                       'Accept': 'application/json' }\n          })\n        .then(r => r.json())\n        .then(j => setSystemRangeLS(j))\n      fetch('hs_only_system_to_system_range.json'\n          ,{headers : {'Content-Type': 'application/json',\n                       'Accept': 'application/json' }\n          })\n        .then(r => r.json())\n        .then(j => setSystemRange(j))\n      fetch('system_to_id.json'\n          ,{headers : {'Content-Type': 'application/json',\n                       'Accept': 'application/json' }\n          })\n        .then(r => r.json())\n        .then(j => {\n          let result = {}\n          Object.keys(j).map((x) => {\n            result[x.toUpperCase()] = j[x];\n          })\n          setSystemNameToId(result)\n        })\n      fetch('id_to_system.json'\n          ,{headers : {'Content-Type': 'application/json',\n                       'Accept': 'application/json' }\n          })\n        .then(r => r.json())\n        .then(j => setSystemIdToName(j))\n      fetch('system_autocomplete.json'\n          ,{headers : {'Content-Type': 'application/json',\n                       'Accept': 'application/json' }\n          })\n        .then(r => r.json())\n        .then(j => setSystemAutocomplete(j))*/\n      fetch('tradable_types.json'\n          ,{headers : {'Content-Type': 'application/json',\n                       'Accept': 'application/json' }\n          })\n        .then(r => r.json())\n        .then(j => setTradableTypes(j))\n      fetch('all_market_items.json'\n          ,{headers : {'Content-Type': 'application/json',\n                       'Accept': 'application/json' }\n          })\n        .then(r => r.json())\n        .then(j => setAllTypes(j))\n    },[])\n\n    let totalDailyTurnoverExpectation = buyOrderLines.map(x => x.sell.price*x.history.daily_volume).reduce((x,y) => x + y, 0);\n    let totalConservativeDailyTurnoverExpectation = buyOrderLines.map(x => x.sell.price*(x.history.daily_volume > x.sell.on_sale_volume ? x.history.daily_volume - x.sell.on_sale_volume : 0)).reduce((x,y) => x + y, 0);\n\n\n\n    const toggle = tab => {\n      if(activeTab !== tab) setActiveTab(tab);\n    }\n\n    /*const findBestRoute = async (orders, start) =>\n    {\n      let maxVolume = maxCargo;\n      let maxPrice = maxValue*1000000;\n      var [sell_orders, buy_orders] = orders;\n      let length = -1;\n      let profit = 0;\n      let bestProfitPerJump = 0;\n      let shortest_systems = [];\n      let bestOperationItemCount = 0;\n      let bestOperationItemVolume = 0;\n      let range_db = systemRange;\n\n      if (selectedRangeDB == \"HS\")\n      {\n        range_db = systemRange;\n      } else if (selectedRangeDB == \"LS\")\n      {\n        range_db = systemRangeLS;\n      }\n\n      for (let i = 0; i < sell_orders.length; i++){\n        let so = sell_orders[i]\n        setCalculationProgress(i/sell_orders.length)\n        await new Promise(r => setTimeout(r, 50));\n        buy_orders.map(bo => {\n          console.log(start,so.system_id,bo.system_id)\n          var range = 2;\n          if (so.system_id !== start)\n          {\n            console.log('sell start',range_db[so.system_id][start])\n            if (!(range_db[so.system_id][start] > -1))\n            {\n                return;\n            }\n            range += range_db[so.system_id][start]\n          }\n          if (so.system_id !== bo.system_id)\n          {\n            //console.log('sell buy',range_db[so.system_id][bo.system_id])\n            if (!(range_db[so.system_id][bo.system_id] > -1))\n            {\n                return;\n            }\n            range += range_db[so.system_id][bo.system_id]\n          }\n          //console.log(range, range_db[so.system_id][start], range_db[so.system_id][bo.system_id])\n          if (!(range > -1))\n          {\n            return;\n          }\n          let maxVolumeFromCost = Math.floor(maxPrice / so.price);\n          let maxVolumeFromCargo = Math.floor(maxVolume / commodities[so.type_id][1]);\n          let operationItemCount = Math.min(so.volume_remain, bo.volume_remain, maxVolumeFromCost, maxVolumeFromCargo);\n          let operationItemVolume = operationItemCount*commodities[so.type_id][1].toFixed(1);\n          let profitPerJump = (bo.price * (100 - taxRate)/100 - so.price) * Math.min(so.volume_remain, bo.volume_remain, maxVolumeFromCost, maxVolumeFromCargo) / range;\n          if (bestProfitPerJump < profitPerJump)\n          {\n            bestOperationItemCount = operationItemCount;\n            bestOperationItemVolume = operationItemVolume;\n            bestProfitPerJump = profitPerJump;\n            length = range;\n            shortest_systems = [start,so.system_id,bo.system_id, so.location_id, bo.location_id,\n                                so.price, so.volume_remain, bo.price, bo.volume_remain];\n          }\n        })\n      }\n      setCalculationProgress(1)\n      //console.log([length, shortest_systems, bestProfitPerJump, length * bestProfitPerJump, bestOperationItemCount, bestOperationItemVolume])\n      return [length, shortest_systems, bestProfitPerJump, length * bestProfitPerJump, bestOperationItemCount, bestOperationItemVolume]\n    }*/\n  let _estimatedBuyVolume = 0;\n\n  return (\n    <Container style={{minHeight:\"100vh\", padding:\"2rem\"}}>\n    <Col sm=\"12\" lg={{size:8, offset:2}} xl={{size:6, offset:3}} style={{background: \"#406AB2\", borderRadius:\"1rem\", opacity:\"80%\"}}>\n    <Nav tabs>\n    <NavItem>\n      <NavLink\n        className={classnames({ active: activeTab === '1' })}\n        onClick={() => { toggle('1'); }}\n        style={{color: \"#E3D370\", fontSize:\"1.2rem\"}}\n      >\n        <b>Buy order generator</b>\n      </NavLink>\n    </NavItem>\n    <NavItem>\n      <NavLink\n        className={classnames({ active: activeTab === '2' })}\n        onClick={() => { toggle('2'); }}\n        style={{color: \"#E3D370\", fontSize:\"1.2rem\"}}\n      >\n       <b>Sell apprisal</b>\n      </NavLink>\n    </NavItem>\n    <NavItem>\n      <NavLink\n        className={classnames({ active: activeTab === '3' })}\n        onClick={() => { toggle('3'); }}\n        style={{color: \"#E3D370\", fontSize:\"1.2rem\"}}\n      >\n       <b>Undercut checker</b>\n      </NavLink>\n    </NavItem>\n  </Nav>\n\n    <TabContent activeTab={activeTab}>\n    <TabPane tabId=\"1\"\n    style={{paddind:\"0.3rem\", color: \"#E3D370\"}}>\n    <div>\n      <Col>\n        <Row className=\"d-flex justify-content-between align-items-center\" style={{margin:\"0.6rem\"}}>From hub:\n      <Col style={{color: \"black\", maxWidth:\"50%\"}}><Select\n          isMulti={false}\n          value={{label: selectedStart, name: hubs[selectedStart].name}}\n          onChange={x => setSelectedStart(x.value)}\n          options={Object.keys(hubs).map(x=> ({value: x, label: hubs[x].name}))}\n        /></Col></Row>\n        <Row className=\"d-flex justify-content-between align-items-center\" style={{margin:\"0.6rem\"}}>To hub:\n      <Col style={{color: \"black\", maxWidth:\"50%\"}}><Select\n            isMulti={false}\n            value={{label: selectedEnd, name: hubs[selectedEnd].name}}\n            onChange={x => setSelectedEnd(x.value)}\n            options={Object.keys(hubs).map(x=> ({value: x, label: hubs[x].name}))}\n          /></Col></Row>\n        {/*}<Row className=\"d-flex justify-content-between align-items-center\"  style={{margin:\"0.6rem\"}}>Max cargo volume, m3: <Input style={{width: \"50%\"}} type=\"number\" min={0} max={2000000} step={1} value={maxCargo} onChange={(x) => setMaxCargo(x.target.value)}></Input></Row>*/}\n        <Row className=\"d-flex justify-content-between align-items-center\"  style={{margin:\"0.6rem\"}}>Max cargo value, MISK: <Input style={{width: \"50%\"}} type=\"number\" min={0} max={2000} step={0.01} value={maxValue} onChange={(x) => setMaxValue(x.target.value)}></Input></Row>\n        <Row className=\"d-flex justify-content-between align-items-center\"  style={{margin:\"0.6rem\"}}>Max unit price, MISK: <Input style={{width: \"50%\"}} type=\"number\" min={0} max={2000} step={0.01} value={maxUnitPrice} onChange={(x) => setMaxUnitPrice(x.target.value)}></Input></Row>\n        <Row className=\"d-flex justify-content-between align-items-center\"  style={{margin:\"0.6rem\"}}>Max unit volume, m3: <Input style={{width: \"50%\"}} type=\"number\" min={0} max={200000} step={1} value={maxUnitVolume} onChange={(x) => setMaxUnitVolume(x.target.value)}></Input></Row>\n        {devMode?(<Row className=\"d-flex justify-content-between align-items-center\" style={{margin:\"0.6rem\"}}>Buy order split:\n        <Col style={{color: \"black\", maxWidth:\"50%\"}}><Select\n              isMulti={false}\n              value={valueSplit}\n              onChange={x => setValueSplit(x)}\n              options={[{label: \"Equal\", value: \"equal\"},\n                        {label: \"Proportional to expected turnover\", value: \"proportional\"},\n                        {label: \"Proportional to conservative expected turnover\", value: \"proportional_conservative\"}]}\n            /></Col></Row>):null}\n        <Row className=\"d-flex justify-content-between align-items-center\"  style={{margin:\"0.6rem\"}}>\n          <Button color=\"primary\" onClick={() => setIgnoreExistingOrders(!ignoreExistingOrders)} active={ignoreExistingOrders}>Ignore existing orders</Button>\n        </Row>\n        {ignoreExistingOrders?(\n          <Row className=\"d-flex justify-content-between align-items-center\"  style={{margin:\"0.6rem\"}}>\n            <Dropzone onDrop={(acceptedFiles) => {\n                  acceptedFiles.forEach((file) => {\n                    const reader = new FileReader()\n\n                    reader.onabort = () => alert('Cannot read the file. Please try again.')\n                    reader.onerror = () => alert('Cannot read the file. Please try again.')\n                    reader.onload = () => {\n                      //let ignoredIds = [];\n                      const fileData = reader.result;\n\n                      let lines = fileData.split(\"\\n\")\n                      console.log(lines[0].split(\",\"))\n                      let header = lines[0].split(\",\");\n                      let location_index = header.indexOf(\"stationID\");\n                      let type_index = header.indexOf(\"typeID\");\n                      let data = lines.slice(1).map(l => [parseInt(l.split(\",\")[type_index]), parseInt(l.split(\",\")[location_index])]);\n                      console.log('setIgnoredTypeIds',data);\n                      setIgnoredTypeIds(data)\n                    }\n                    reader.readAsText(file)\n                  })}}>\n              {({getRootProps, getInputProps}) => (\n                <section>\n                  <div {...getRootProps()}>\n                    <input {...getInputProps()} />\n                    <p>Drag 'n' drop latest market order export here</p>\n                    {(ignoredTypeIds.length > 0 ? (<p>Currently ignoring {ignoredTypeIds.filter(x => x[1] === hubs[selectedEnd].location).length} types.</p>):(<p></p>))}\n                  </div>\n                </section>\n              )}\n            </Dropzone>\n          </Row>):(<Row></Row>)}\n        <Row className=\"p-5\"><Button className=\"padded\" color=\"info\" disabled={queryInProgress} onClick={\n            ()=>[setQueryInProgress(true),\n            setBuyOrderLines([]),\n            setSelectedTypes([]),\n            calculateProfitability(tradableTypes, selectedStart, selectedEnd, maxUnitPrice, maxUnitVolume, ignoreExistingOrders ? ignoredTypeIds : [], setProfitReport, setQueryInProgress, setEstimatedBuyVolume)]\n          }>{queryInProgress?\"Loading and calculating. Please wait.\":\"Query best deals\"}</Button></Row>\n\n        {buyOrderLines.length > 0 ? (<Row className=\"d-flex justify-content-between align-items-center\" style={{margin:\"0.6rem\"}}>\n        <Col>\n          <h3>Generated buy order</h3>\n          <Row className=\"d-flex justify-content-center align-items-center\"  style={{margin:\"0.6rem\"}}>\n            <table style={{margin:\"0.6rem\"}}>\n            {buyOrderLines.map(x => <tr key={JSON.stringify(x) + new Date()}><td>{x.info.name}</td><td>{\n              ((() => {\n                  let volumeToBuy = 0;\n                  if (valueSplit.value === \"equal\")\n                  {\n                    volumeToBuy = (maxPrice/buyOrderLines.length/x.buy.price).toFixed(0);\n                  } else if (valueSplit.value === \"proportional\")\n                  {\n                    volumeToBuy = (x.buy.price*x.history.daily_volume / totalDailyTurnoverExpectation * maxPrice /x.buy.price).toFixed(0);\n                  } else if (valueSplit.value === \"proportional_conservative\")\n                  {\n                    volumeToBuy = (x.buy.price*(x.history.daily_volume > x.sell.on_sale_volume ? x.history.daily_volume - x.sell.on_sale_volume : 0)/ totalConservativeDailyTurnoverExpectation * maxPrice /x.buy.price).toFixed(0);\n                  }\n                  _estimatedBuyVolume += volumeToBuy * x.info.volume;\n                  return volumeToBuy;\n              })())\n              }</td></tr>)}\n            </table>\n          </Row>\n          <Row className=\"d-flex justify-content-center align-items-center\"  style={{margin:\"0.6rem\"}}>Estimated buy order volume is: {_estimatedBuyVolume.toFixed(2)} m3</Row>\n        </Col></Row>) : (<Row/>)}\n        <Row>\n          {profitReport.length > 0 ? (<Col><Row><h3>Best items to haul</h3></Row>\n          <Row style={{margin:\"0.6rem\"}}><Table dark striped><thead>\n            <tr><th></th><th>Item</th><th>Competition, h</th><th>Margin, %</th><th>ISK/m3</th></tr></thead><tbody>\n            {\n              profitReport.slice(0,60).map(x => (<tr key={JSON.stringify(x) + new Date()}>\n\n              <td>\n                <Input type=\"checkbox\" checked={selectedTypes.includes(x.id)} onChange={e => {\n                    console.log(selectedTypes)\n                    if (e.target.checked)\n                    {\n                       if (!selectedTypes.includes(x.id))\n                       {\n                         selectedTypes.push(x.id);\n                         setSelectedTypes(selectedTypes.slice());\n                         setBuyOrderLines(profitReport.filter(x => selectedTypes.includes(x.id) ));\n                       }\n                    }\n                    else {\n                       if (selectedTypes.includes(x.id))\n                       {\n                         let newList = selectedTypes.filter( y => y !== x.id);\n                         setSelectedTypes(newList);\n                         setBuyOrderLines(profitReport.filter(x => newList.includes(x.id) ));\n                       }\n                    }\n                  }}/>\n              </td>\n              <td className=\"text-left\">\n                {x.info.name}\n              </td>\n              <td>{((x.sell.on_sale_volume / x.history.daily_volume)*24).toFixed(1)}</td>\n              <td>{x.price_margin.toFixed(1)}</td>\n              <td>{(x.buy.price / x.info.volume).toFixed(0.1)}</td></tr>))\n            }\n          </tbody></Table></Row></Col>):(<div></div>)}\n        </Row>\n      </Col>\n    </div>\n    </TabPane>\n    </TabContent>\n\n    <TabContent activeTab={activeTab}>\n    <TabPane tabId=\"2\"\n    style={{paddind:\"0.3rem\", color: \"#E3D370\"}}>\n    <Row className=\"d-flex justify-content-between align-items-center\" style={{margin:\"0.6rem\"}}>In hub:\n  <Col style={{color: \"black\", maxWidth:\"50%\"}}><Select\n          isMulti={false}\n          value={{label: selectedEnd, name: hubs[selectedEnd].name}}\n          onChange={x => setSelectedEnd(x.value)}\n          options={Object.keys(hubs).map(x=> ({value: x, label: hubs[x].name}))}\n        /></Col>\n      </Row>\n    <Row className=\"d-flex justify-content-between align-items-center\" style={{margin:\"0.6rem\"}}>\n      <textarea className=\"w-100\"\n                onChange={(x)=>setInventoryRaw(x.target.value)}\n                placeholder=\"Paste your inventory here and get suggested sell prices based on the latest competition info\"\n                value={inventoryRaw}>\n      </textarea>\n    </Row>\n    <Row className=\"d-flex justify-content-between align-items-center\" style={{margin:\"0.6rem\"}}>\n      <Button color=\"info\" onClick={()=>{\n          let lines = inventoryRaw.split('\\n');\n          let typenames = lines.map(l => l.split('\\t')[0]).filter(l => l.length > 0);\n          let selectedTypes = typenames.map( tn => {\n              let tmp = allTypes.filter(t => t.name === tn);\n              if (tmp.length === 0)\n                  return [];\n              return tmp[0].id}).reverse();\n          console.log(typenames)\n          if (selectedTypes.length > 0)\n            getSuggestedSellPrice(allTypes, selectedTypes, selectedEnd, setSuggestedSell, setQueryInProgress);\n          else\n            setSuggestedSell([])\n        }}>{queryInProgress?\"Loading and calculating. Please wait.\":\"Get suggested sell prices\"}</Button>\n    </Row>\n    <Row className=\"d-flex justify-content-between align-items-center\" style={{margin:\"0.6rem\"}}>\n      <Table dark striped><thead>\n        <tr><th>Item</th><th>Suggested sell price</th></tr></thead><tbody>\n      {suggestedSell.map((x)=>x?(<tr><th>{x.info.name}</th><th>{x.sell.price.toFixed(2)}</th></tr>):null)}\n      </tbody></Table>\n    </Row>\n\n    </TabPane>\n  </TabContent>\n\n  <TabContent activeTab={activeTab}>\n  <TabPane tabId=\"3\"\n  style={{paddind:\"0.3rem\", color: \"#E3D370\"}}>\n  <p style={{margin:\"1rem\", color: \"white\"}}>Select recent export of corporation or personal orders to check if you need to update the price</p>\n    <Row className=\"d-flex justify-content-between align-items-center\"  style={{margin:\"0.6rem\"}}>\n      <Dropzone onDrop={(acceptedFiles) => {\n            acceptedFiles.forEach((file) => {\n              const reader = new FileReader()\n\n              reader.onabort = () => alert('Cannot read the file. Please try again.')\n              reader.onerror = () => alert('Cannot read the file. Please try again.')\n              reader.onload = async () => {\n                //let ignoredIds = [];\n                const fileData = reader.result;\n\n                let lines = fileData.split(\"\\n\")\n                console.log(lines[0].split(\",\"))\n                let header = lines[0].split(\",\");\n                let order_index = header.indexOf(\"orderID\");\n                let location_index = header.indexOf(\"stationID\");\n                let region_index = header.indexOf(\"regionID\");\n                let type_index = header.indexOf(\"typeID\");\n                let name_index = header.indexOf(\"charName\");\n                let price_index = header.indexOf(\"price\");\n                let data = lines.slice(1).map(l => ({\"type\": parseInt(l.split(\",\")[type_index]),\n                                                    \"location\": parseInt(l.split(\",\")[location_index]),\n                                                    \"name\": l.split(\",\")[name_index],\n                                                    \"order\": parseInt(l.split(\",\")[order_index]),\n                                                    \"region\": parseInt(l.split(\",\")[region_index]),\n                                                    \"price\": parseFloat(l.split(\",\")[price_index])}))\n                                         .filter(x => hubs_by_id[x.location])\n                                         .filter(x => allTypes.filter(y => y.id === x.type).length)\n                                         .map(x => ({\"type_name\": allTypes.filter(y => y.id === x.type)[0].name,\n                                                    \"location_name\": hubs_by_id[x.location].name,\n                                                    \"trader_name\": x.name,\n                                                    \"order_id\": x.order,\n                                                    \"type_id\": x.type,\n                                                    \"region\": x.region,\n                                                    \"location\": x.location,\n                                                    \"price\": x.price}))\n                                         .sort((x,y) => (x.type_name > y.type_name)?1:-1)\n                                         .sort((x,y) => (x.location_name > y.location_name)?1:-1)\n                                         .sort((x,y) => (x.trader_name > y.trader_name)?1:-1);\n                let my_orders = data.map(x => x.order_id)\n                let cheapest_orders = (await Promise.all(data.map(async (o) => ({my: o,\n                                                                                 cheapest: await queryCheapestOrder(o.type_id,o.region,o.location),\n                                                                                 undercut: await queryVolumeBelowPrice(o.type_id,o.price,o.region,o.location),\n                                                                                 history: await queryPriceHistoryAndVolume(o.type_id,o.region, 30)}))))\n                                      .filter(x => !my_orders.includes(x.cheapest.order_id))\n                                      .map(x => [x.my.trader_name,\n                                                 x.my.location_name,\n                                                 x.my.type_name,\n                                                 Number((x.cheapest.price*0.995).toPrecision(4)),\n                                                 ((x.my.price - Number((x.cheapest.price*0.995).toPrecision(4)))/x.my.price*100).toFixed(1),\n                                                 (x.undercut/x.history.daily_volume * 24).toFixed(1)])\n\n                console.log(cheapest_orders);\n                console.log(data);\n                setUnderCutReport(cheapest_orders)\n              }\n              reader.readAsText(file)\n            })}}>\n        {({getRootProps, getInputProps}) => (\n          <section>\n            <div {...getRootProps()}>\n              <input {...getInputProps()} />\n              <p>Drag 'n' drop latest market order export here</p>\n            </div>\n          </section>\n        )}\n      </Dropzone>\n    </Row>\n    <Row className=\"d-flex justify-content-between align-items-center\" style={{margin:\"0.6rem\"}}>\n      {(underCutReport.length > 0 ?\n        (<Table dark={true} striped={true}><thead><tr>\n                                    <th>Trader</th>\n                                    <th>Hub</th>\n                                    <th>Item</th>\n                                    <th>Suggested price</th>\n                                    <th>Discount, %</th>\n                                    <th>Undercutting volume, h</th>\n                                  </tr></thead><tbody>\n          {underCutReport.map(x => (<tr>\n                                      <td>{x[0]}</td>\n                                      <td>{x[1]}</td>\n                                      <td>{x[2]}</td>\n                                      <td>{x[3]}</td>\n                                      <td>{x[4]}</td>\n                                      <td>{x[5]}</td>\n                                    </tr>))}\n        </tbody></Table>):(<table></table>))}\n    </Row>\n\n  </TabPane>\n</TabContent>\n\n  <center className=\"m-2\"\n        style={{\n        \tzIndex: -100,\n        \tposition: \"relative\"\n        }}>\n      <Card style={{maxWidth: \"80%\"}}>\n\n        <CardImg src={latest_thumbnail}></CardImg>\n      <CardBody>\n        <CardTitle>Level up your hauling game in EVE online with market analysis tools. Part 1</CardTitle>\n      <Button color=\"success\" onClick={()=> window.open(\"https://www.youtube.com/watch?v=lIxXnVrRH7U\", \"_blank\")}>Watch on YouTube</Button>\n      </CardBody>\n      </Card>\n    </center>\n    <div className=\"footerSpacer\"></div>\n    <div className=\"fixed-bottom responsiveFooter\">\n        <Navbar color=\"dark\" dark>\n            <Container>\n                <NavbarBrand className=\"w-100\">\n                <NavLink style={{color: \"white\"}} className=\"w-100\" href=\"https://pterippi.fi\">\n                <Row className=\"d-flex w-100 flex-row justify-content-around align-items-center\">\n                <Col sm={12} lg={6}>\n                <img alt=\"Logo of Pterippi Oy\"\n                     style={{maxHeight: \"5vh\",\n                             filter: \"brightness(0) invert(1)\"}}\n                     src=\"https://pterippi.fi/static/media/pterippi-logo.80fae1c3.png\"/>\n                </Col>\n                <Col sm={12} lg={6} className=\"text-wrap\">This tools was developed by Pterippi Oy.<br/>Contact us if you need custom digital tools for your business.</Col></Row></NavLink></NavbarBrand>\n              <NavbarBrand className=\"w-100 text-wrap text-muted\" style={{fontSize:\"0.6rem\"}}>2021 (c) Pterippi Oy. All rights reserved. Data is provided by ESI API courtesy of CCP Games. <br/>\n              EVE Online and the EVE logo are the registered trademarks of CCP hf. All rights are reserved worldwide.\n\n              All other trademarks are the property of their respective owners. EVE Online, the EVE logo, EVE and all associated logos and designs are the intellectual property of CCP hf. All artwork, screenshots, characters, vehicles, storylines, world facts or other recognizable features of the intellectual property relating to these trademarks are likewise the intellectual property of CCP hf. CCP hf. has granted permission to eveonlineships.com to use EVE Online and all associated logos and designs for promotional and information purposes on its website but does not endorse, and is not in any way affiliated with, eveonlineships.com.\n\n              CCP is in no way responsible for the content on or functioning of this website, nor can it be liable for any damage arising from the use of this website.\n        </NavbarBrand>\n            </Container>\n        </Navbar>\n    </div>\n  </Col>\n  </Container>\n  );\n}\n\nexport default Market;\n",{"ruleId":"33","severity":1,"message":"34","line":3,"column":8,"nodeType":"35","messageId":"36","endLine":3,"endColumn":24},{"ruleId":"33","severity":1,"message":"37","line":5,"column":31,"nodeType":"35","messageId":"36","endLine":5,"endColumn":39},{"ruleId":"33","severity":1,"message":"38","line":5,"column":120,"nodeType":"35","messageId":"36","endLine":5,"endColumn":128},{"ruleId":"33","severity":1,"message":"39","line":6,"column":10,"nodeType":"35","messageId":"36","endLine":6,"endColumn":20},{"ruleId":"33","severity":1,"message":"40","line":6,"column":22,"nodeType":"35","messageId":"36","endLine":6,"endColumn":37},{"ruleId":"33","severity":1,"message":"41","line":6,"column":39,"nodeType":"35","messageId":"36","endLine":6,"endColumn":53},{"ruleId":"33","severity":1,"message":"42","line":8,"column":18,"nodeType":"35","messageId":"36","endLine":8,"endColumn":26},{"ruleId":"33","severity":1,"message":"43","line":9,"column":14,"nodeType":"35","messageId":"36","endLine":9,"endColumn":26},{"ruleId":"44","severity":1,"message":"45","line":174,"column":27,"nodeType":"46","messageId":"47","endLine":174,"endColumn":54},{"ruleId":"33","severity":1,"message":"48","line":468,"column":12,"nodeType":"35","messageId":"36","endLine":468,"endColumn":30},"no-unused-vars","'InputAutoSuggest' is defined but never used.","Identifier","unusedVar","'Progress' is defined but never used.","'FormText' is defined but never used.","'InputGroup' is defined but never used.","'InputGroupAddon' is defined but never used.","'InputGroupText' is defined but never used.","'CardText' is defined but never used.","'CardSubtitle' is defined but never used.","no-loop-func","Function declared in a loop contains unsafe references to variable(s) 'timeout'.","ArrowFunctionExpression","unsafeRefs","'estimatedBuyVolume' is assigned a value but never used."]